// /*----- constants -----*/
const secondDeck = [
  {
    card: "2s",
    rank: 2,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-r02.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "3s",
    rank: 3,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-r03.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "4s",
    rank: 4,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-r04.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "5s",
    rank: 5,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-r05.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "6s",
    rank: 6,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-r06.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "7s",
    rank: 7,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-r07.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "8s",
    rank: 8,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-r08.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "9s",
    rank: 9,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-r09.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "10s",
    rank: 10,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-r10.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Js",
    rank: 11,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-J.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Qs",
    rank: 12,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-Q.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Ks",
    rank: 13,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-K.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "As",
    rank: 14,
    suit: "spades",
    img: "../css/card-library/images/spades/spades-A.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "2d",
    rank: 2,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-r02.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "3d",
    rank: 3,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-r03.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "4d",
    rank: 4,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-r04.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "5d",
    rank: 5,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-r05.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "6d",
    rank: 6,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-r06.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "7d",
    rank: 7,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-r07.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "8d",
    rank: 8,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-r08.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "9d",
    rank: 9,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-r09.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "10d",
    rank: 10,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-r10.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Jd",
    rank: 11,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-J.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Qd",
    rank: 12,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-Q.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Kd",
    rank: 13,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-K.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Ad",
    rank: 14,
    suit: "diamonds",
    img: "../css/card-library/images/diamonds/diamonds-A.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "2c",
    rank: 2,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-r02.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "3c",
    rank: 3,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-r03.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "4c",
    rank: 4,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-r04.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "5c",
    rank: 5,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-r05.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "6c",
    rank: 6,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-r06.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "7c",
    rank: 7,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-r07.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "8c",
    rank: 8,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-r08.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "9c",
    rank: 9,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-r09.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "10c",
    rank: 10,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-r10.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Jc",
    rank: 11,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-J.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Qc",
    rank: 12,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-Q.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Kc",
    rank: 13,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-K.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Ac",
    rank: 14,
    suit: "clubs",
    img: "../css/card-library/images/clubs/clubs-A.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "2h",
    rank: 2,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-r02.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "3h",
    rank: 3,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-r03.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "4h",
    rank: 4,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-r04.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "5h",
    rank: 5,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-r05.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "6h",
    rank: 6,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-r06.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "7h",
    rank: 7,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-r07.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "8h",
    rank: 8,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-r08.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "9h",
    rank: 9,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-r09.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "10h",
    rank: 10,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-r10.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Jh",
    rank: 11,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-J.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Qh",
    rank: 12,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-Q.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Kh",
    rank: 13,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-K.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "Ah",
    rank: 14,
    suit: "hearts",
    img: "../css/card-library/images/hearts/hearts-A.svg",
    isShowing: true,
    isHold: false,
  },
  {
    card: "null",
    rank: null,
    suit: null,
    img: "../css/card-library/images/backs/red.svg",
    isShowing: true,
    isHold: false,
  },
];

/*----- state variables -----*/
let betSize;
let playerCredits;
let handOver;
let gameOver;
let deck;
let gameStage;
let playerHand;
let playerWin;

/*----- cached elements  -----*/
payoutEl = document.getElementById("pay-message");
betMessageEl = document.getElementById("bet-message");
playerCreditEl = document.getElementById("credit-message");
dealBtnEl = document.getElementById("dealBtn");
betOneBtnEl = document.getElementById("betBtn");
betMaxBtnEl = document.getElementById("betBtnMax");
playerCardEls = document.querySelectorAll(".cards-row > img");
holdCardEls = document.querySelector(".cards-row");
holdEls = document.querySelector(".hold-row");

/*----- event listeners -----*/
betOneBtnEl.addEventListener("click", handleBetOneClick);
betMaxBtnEl.addEventListener("click", handleBetMaxClick);
dealBtnEl.addEventListener("click", function (evt) {
  handleDealClick(evt);
  handleReDeal(evt);
});
holdCardEls.addEventListener("click", handleCardClick);

/*----- functions -----*/

//GAME OPERATIONS FUNCTIONS
init();

function init() {
  hand = [null, null, null, null, null];
  betSize = 0;
  playerCredits = 400;
  handOver = true;
  gameOver = false;
  gameStage = "preFlop";
  playerWin = 0;

  render();
}

function newHand() {
  hand = [null, null, null, null, null];
  playerCredits;
  playerWin;
  betSize;
  handOver = true;
  gameOver = false;
  gameStage = "preFlop";

  render();
}

function postFlop() {
  gameStage = "postFlop";

  holdCards();
  renderPlayerHand();
  handleReDeal();
}

function finalStage() {
  gameStage = "finish";
  if (playerCredits === 0) return;
  //determine if hand wins
  //if winner, display amount won and increase player credit
  playerWin = 0;
  //deal button disabled
  //if bet button pressed, switch to new hand function
  console.log(gameStage);
}

//DECK SHUFFLE

function deckShuffle() {
  deck = [...secondDeck];
  for (let k = 0; k < 1000; k++) {
    for (let i = deck.length - 1; i--; ) {
      let j = Math.floor(Math.random() * (i + 1));
      let temp = deck[i];
      deck[i] = deck[j];
      deck[j] = temp;
    }
  }
  return deck;
}

//HANDLE FUNCTIONS
function handleDealClick(evt) {
  // GUARD
  if (evt.target.tagName !== "BUTTON") return;
  //PREFLOP CLICK
  if (betSize >= 1 && betSize <= 5 && gameStage === "preFlop") {
    deckShuffle();

    playerHand = [deck[0], deck[1], deck[2], deck[3], deck[4]];
    renderPlayerHand();
    postFlop();

    render();
  }
}

// HANDLE BET SIZE CLICKS
function handleBetOneClick() {
  if (betSize < 5 && (gameStage === "preFlop" || gameStage === "finish")) {
    betSize++;
    playerCredits--;
    newHand();
  } else return;

  render();
}

function handleBetMaxClick() {
  if (betSize < 5 && handOver === true) {
    betSize = 5;
    playerCredits = playerCredits - 5;
    newHand();
    //increase bet size to 5
  } else return;
}

// HANDLE CARD CLICKS FOR HOLD
function handleCardClick(evt) {
  let cardIdx = evt.target.alt - 1;
  // GUARD
  if (evt.target.tagName !== "IMG");
  if (gameStage === "postFlop") {
    playerHand[cardIdx].isHold = true;
  } else return;

  holdCards();
  render();
}

function holdCards() {
  playerHand.forEach((element, idx) => {
    if (element.isHold === true) {
      let holdElement = document.getElementById(`card-${idx + 1}`);
      holdElement.style.visibility = "visible";
      element = deck[5];
    } else return;

    render();
  });
}

function handleReDeal(evt) {
  if (evt.target.tagName !== "BUTTON") return;
  if (gameStage === "postFlop") {
    let cardsNeeded = 4;
    for (let i = 0; i < playerHand.length; i++) {
      if (playerHand[i].isHold === false) {
        console.log(playerHand[i], cardsNeeded);
        cardsNeeded++;
        playerHand[i] = deck[cardsNeeded];
        // playerHand.splice(playerHand[i], 1, deck[cardsNeeded]);
      }
    }
  }
  render();
}

// RENDER FUNCTIONS

function renderWinCredit() {
  payoutEl.innerText = `WIN ${playerWin}`;
}

function renderBetMessage() {
  betMessageEl.innerText = `Bet ${betSize}`;
}

function renderPlayerCredit() {
  playerCreditEl.innerText = `${playerCredits} CREDITS`;
}

function renderPreFlop() {}

function renderPostFlop() {
  //bet buttons disabled
  betOneBtnEl.setAttribute("disabled", "");
  betMaxBtnEl.setAttribute("disabled", "");
}

function renderPlayerHand() {
  playerCardEls.forEach((card, idx) => {
    card.src = playerHand[idx].img;
    console.log(card);
  });
}

function renderFinalStage() {}

function replaceCards(el) {
  el = deck[6];
}

function render() {
  renderPlayerCredit();
  renderWinCredit();
  renderBetMessage();
  renderPlayerHand();
  // renderCardClick();
  // renderHoldSign();
}

function renderReDeal() {
  renderPlayerHand();
}

render();

//FUNCTION WINNING LOGIC
function getWinner() {}
